function Formodel(t){this.form=t.form,this.model=t.model||this.getForm().attr("data-model"),this.errorListCode=t.errorListCode||422,this.attributes=t.attributes,this.rootUrl=t.rootUrl||"",this.tokenKey=t.tokenKey||"_token",this.token=t.token||"",this.idKey=t.idKey||null,this.errorList=t.errorList||null,this.appendError=t.appendError||this._appendError,this.handleUpdate=t.handleUpdate||function(){},this.handleStore=t.handleStore||function(){},this.handleDelete=t.handleDelete||function(){},this.handleGet=t.handleGet||function(){},this.handleNew=t.handleNew||function(){},this.handleError=t.handleError||function(){},this.handleBeforeSend=t.handleBeforeSend||function(){},this.handleSuccess=t.handleSuccess||function(){},this.targetBefore=t.targetBefore||function(){},this.targetAfter=t.targetAfter||function(){},this.clearAfterStore=t.clearAfterStore||!0,this.clearAfterUpdate=t.clearAfterUpdate||!0,this.usingTemplates=t.usingTemplates||!0,this.storable=t.storable||!0,this.updatable=t.updatable||!0,this.deletable=t.deletable||!0,this.gettable=t.gettable||!0,this.otherData=t.otherData||{},this.recordId=-1,this.target=null,this.targetOriginal=null,this._init()}Formodel.templates={loading:'<i class="fa fa-spinner faa-spin animated"></i>',success:'<i class="fa fa-eye"></i>',error:'<i class="fa fa-exclamation-triangle"></i>'},Formodel.prototype.clear=function(){var t=this.getAttributes();for(var e in t)"string"!=typeof t[e]?t[e].clear(this):this.fillInput(t[e],e,"")},Formodel.prototype.get=function(t,e){if(this.setTarget(e),this.gettable){this.setRecordId(t);var r=this.getAjaxData(),o=this.getUrl(this.getRecordId());this._ajax(o,"GET",r,this._handleGet)}},Formodel.prototype["new"]=function(){this.setRecordId(-1),this.clear(),this._handleNew(this)},Formodel.prototype.destroy=function(t){if(this.setTarget(t),this.getRecordId()>-1&&this.deletable){var e=this.getUrl(this.getRecordId()),r=this.getFormData();this._ajax(e,"DELETE",r,this._handleDelete)}},Formodel.prototype.save=function(t){this.setTarget(t),this.getRecordId()>0&&this.updatable?this._update():this.storable&&this._store()},$.fn.extend({formodel:function(t){var e=$(this).attr("id");return t.form=e,new Formodel(t)}}),Formodel.prototype._ajax=function(t,e,r,o){var i=this;r=this.getAjaxData(r),$.ajax({url:t,type:e,data:r,beforeSend:function(){i._handleBeforeSend(i),i._targetBefore(),i.usingTemplates&&i._setTargetTemplate("loading")},success:function(t){i._targetAfter(!0,t),i.handleSuccess(i,t),i.usingTemplates&&i._setTargetTemplate(null),o(i,t)},error:function(t){i._targetAfter(!1,t),i._handleError(i,t),i.usingTemplates&&i._setTargetTemplate("error")}})},Formodel.prototype._init=function(){var t=this;this.getForm().submit(function(e){e.preventDefault(),t.save($(this).find('button[type="submit"]'))})},Formodel.prototype._update=function(){var t=this.getUrl(this.getRecordId()),e=this.getFormData();this._ajax(t,"PUT",e,this._handleUpdate)},Formodel.prototype._store=function(){var t=this.getUrl(),e=this.getFormData();this._ajax(t,"POST",e,this._handleStore)},Formodel.prototype._setTargetTemplate=function(t){null!==this.target&&void 0!==this.target&&(void 0!==t&&null!==t?(null!=$(this.target).attr("data-original")&&""!=$(this.target).attr("data-original")&&void 0!==$(this.target).attr("data-original")||$(this.target).attr("data-original",$(this.target).html()),$(this.target).html(Formodel.templates[t])):$(this.target).html($(this.target).attr("data-original")))},Formodel.prototype.setTarget=function(t){void 0!==t&&null!=t&&""!=t||(t=null),this.target=t},Formodel.prototype._targetAfter=function(t,e){this.targetAfter(this.target,t,e)},Formodel.prototype._targetBefore=function(){this.targetBefore(this.target)},Formodel.prototype._appendError=function(t){return"<li>"+t+"</li>"},Formodel.prototype.getInputValue=function(t,e){var r="";switch(t.toLowerCase()){case"checkbox":return r='input[type="'+t+'"][name="'+e+'"]',this.getForm().find(r).prop("checked");case"radio":return r='input[type="'+t+'"][name="'+e+'"]',this.getForm().find(r).val();case"select":return r=t+'[name="'+e+'"]',this.getForm().find(r).val();default:return r=t+'[name="'+e+'"]',this.getForm().find(r).val().trim()}},Formodel.prototype.getErrorList=function(){return void 0!==this.errorList&&null!=this.errorList?$("#"+this.errorList):null},Formodel.prototype.getFormData=function(t){var e=this.getOtherData(),r=this.getAttributes();t=void 0!==this.idKey&&null!=this.idKey?this.idKey:t;for(var o in r)if("string"!=typeof r[o])e[o]=r[o].get(this);else{var i=this.getInputValue(r[o],o);e[o]=i||null}return void 0!==t&&null!=t&&(e[t]=this.getRecordId()),this.requestData=e,this.requestData},Formodel.prototype.getForm=function(){return $("#"+this.form)},Formodel.prototype.getAttributes=function(t){return void 0!==t?this.attributes[t]:this.attributes},Formodel.prototype.getUrl=function(t){return t=void 0!==t?"/"+t:"",this.getRootUrl()+"/"+this.getModel()+t},Formodel.prototype.getRootUrl=function(){var t="/"==this.rootUrl.charAt(this.rootUrl.length-1)?1:0;return this.rootUrl.slice(0,this.rootUrl.length-t)},Formodel.prototype.getModel=function(){return this.model},Formodel.prototype.getAjaxData=function(t){return t=t||{},t[this.tokenKey]=this.token,t},Formodel.prototype.getRequestData=function(){return this.requestData},Formodel.prototype.getRecordId=function(){return parseInt(this.recordId,10)},Formodel.prototype.getOtherData=function(){return this.otherData},Formodel.prototype._handleUpdate=function(t,e){t.handleUpdate(t,e),t.clearAfterUpdate&&t.clear()},Formodel.prototype._handleStore=function(t,e){t.handleStore(t,e),t.clearAfterStore&&t.clear()},Formodel.prototype._handleNew=function(t){t.setErrors(t),t.handleNew(t)},Formodel.prototype._handleDelete=function(t,e){t.handleDelete(t,e),t.clear()},Formodel.prototype._handleGet=function(t,e){t.fillWith(e),t.handleGet(t,e)},Formodel.prototype._handleError=function(t,e){null!=t.getErrorList()&&e.status==t.errorListCode&&t.setErrors(t,e.responseJSON),t.handleError(t,e)},Formodel.prototype._handleBeforeSend=function(t){t.setErrors(t),t.handleBeforeSend(t)},Formodel.prototype.setRecordId=function(t){t=parseInt(t,10),this.recordId=void 0!==t&&null!==t&&t>-1&&!isNaN(t)?t:-1},Formodel.prototype.fillInput=function(t,e,r){var o="";switch(t.toLowerCase()){case"checkbox":case"radio":o='input[type="'+t+'"][name="'+e+'"]',r=isNaN(parseInt(r,10))?r:parseInt(r,10),this.getForm().find(o).prop("checked",r).change();break;case"select":o=t+'[name="'+e+'"]',(null==r||""==r||r<0)&&(r=this.getForm().find(o).find("option:first").val()),this.getForm().find(o).val(r).change();break;default:r="string"==typeof r?r.trim():r,o=t+'[name="'+e+'"]',this.getForm().find(o).val(r).change()}},Formodel.prototype.fillCustom=function(t,e,r){e(t,r,this)},Formodel.prototype.setErrors=function(t,e){var r=t.getErrorList();null!=r&&(r.html(""),void 0!==e?($.each(e,function(e,o){r.append(t.appendError(o[0]))}),r.slideDown()):r.hide())},Formodel.prototype.fillWith=function(t){var e=this.getAttributes();for(var r in e)"string"!=typeof e[r]?this.fillCustom(r,e[r].set,t[r]):this.fillInput(e[r],r,t[r])},Formodel.prototype.addOtherData=function(t,e){this.otherData[t]=e},Formodel.prototype.setOtherData=function(t){this.otherData=t||{}},Formodel.prototype.removeOtherData=function(t){delete this.otherData[t]};