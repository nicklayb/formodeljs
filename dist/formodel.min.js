function Formodel(t){this.form=t.form,this.model=t.model||this.getForm().attr("data-model"),this.attributes=t.attributes,this.rootUrl=t.rootUrl||"",this.tokenKey=t.tokenKey||"_token",this.token=t.token||"",this.handleUpdate=t.handleUpdate||function(){},this.handleStore=t.handleStore||function(){},this.handleDelete=t.handleDelete||function(){},this.handleGet=t.handleGet||function(){},this.handleError=t.handleError||function(){},this.handleBeforeSend=t.handleBeforeSend||function(){},this.handleSuccess=t.handleSuccess||function(){},this.targetBefore=t.targetBefore||function(){},this.targetAfter=t.targetAfter||function(){},this.recordId=-1,this.clearAfterStore=t.clearAfterStore||!0,this.clearAfterUpdate=t.clearAfterUpdate||!0,this.usingTemplates=t.usingTemplates||!0,this.target=null,this.targetOriginal=null,this._init()}Formodel.templates={loading:'<i class="fa fa-spinner faa-spin animated"></i>',success:'<i class="fa fa-eye"></i>',error:'<i class="fa fa-exclamation-triangle"></i>'},Formodel.prototype.clear=function(){var t=this.getAttributes();for(var e in t)this.fillInput(t[e],e,"")},Formodel.prototype.get=function(t,e){this.setTarget(e),this.setRecordId(t);var r=this.getAjaxData(),o=this.getUrl(this.getRecordId());this._ajax(o,"GET",r,this._handleGet)},Formodel.prototype["new"]=function(){this.setRecordId(-1),this.clear()},Formodel.prototype.destroy=function(t){if(this.setTarget(t),this.getRecordId()>-1){var e=this.getUrl(this.getRecordId()),r=this.getFormData();this._ajax(e,"DELETE",r,this._handleDelete)}},Formodel.prototype.save=function(t){this.setTarget(t),this.getRecordId()>0?this._update():this._store()},Formodel.prototype._ajax=function(t,e,r,o){var a=this;r=this.getAjaxData(r),$.ajax({url:t,type:e,data:r,beforeSend:function(){a.handleBeforeSend(a),a._targetBefore(),a.usingTemplates&&a._setTargetTemplate("loading")},success:function(t){a._targetAfter(!0,t),a.handleSuccess(a,t),a.usingTemplates&&a._setTargetTemplate(null),o(a,t)},error:function(t){a._targetAfter(!1,t),a.handleError(a,t),a.usingTemplates&&a._setTargetTemplate("error")}})},Formodel.prototype._init=function(){var t=this;this.getForm().submit(function(e){e.preventDefault(),t.save($(this).find('button[type="submit"]'))})},Formodel.prototype._update=function(){var t=this.getUrl(this.getRecordId()),e=this.getFormData();this._ajax(t,"PUT",e,this._handleUpdate)},Formodel.prototype._store=function(){var t=this.getUrl(),e=this.getFormData();this._ajax(t,"POST",e,this._handleStore)},Formodel.prototype._setTargetTemplate=function(t){null!==this.target&&void 0!==this.target&&(void 0!==t&&null!==t?(null!=$(this.target).attr("data-original")&&""!=$(this.target).attr("data-original")&&void 0!==$(this.target).attr("data-original")||$(this.target).attr("data-original",$(this.target).html()),$(this.target).html(Formodel.templates[t])):$(this.target).html($(this.target).attr("data-original")))},Formodel.prototype.setTarget=function(t){void 0!==t&&null!=t&&""!=t||(t=null),this.target=t},Formodel.prototype._targetAfter=function(t,e){this.targetAfter(this.target,t,e)},Formodel.prototype._targetBefore=function(){this.targetBefore(this.target)},Formodel.prototype.getInputValue=function(t,e){switch(t.toLowerCase()){case"checkbox":case"radio":break;default:var r=t+'[name="'+e+'"]';return $(r).val().trim()}},Formodel.prototype.getFormData=function(t){var e={},r=this.getAttributes();for(var o in r){var a=this.getInputValue(r[o],o);e[o]=a}return void 0!==t&&(e[t]=this.getRecordId()),this.requestData=e,this.requestData},Formodel.prototype.getForm=function(){return $("#"+this.form)},Formodel.prototype.getAttributes=function(t){return void 0!==t?this.attributes[t]:this.attributes},Formodel.prototype.getUrl=function(t){return t=t||"",this.getRootUrl()+"/"+this.getModel()+"/"+t},Formodel.prototype.getRootUrl=function(){var t="/"==this.rootUrl.charAt(this.rootUrl.length-1)?1:0;return this.rootUrl.slice(0,this.rootUrl.length-t)},Formodel.prototype.getModel=function(){return this.model},Formodel.prototype.getAjaxData=function(t){var t=t||{};return t[this.tokenKey]=this.token,t},Formodel.prototype.getRequestData=function(){return this.requestData},Formodel.prototype.getRecordId=function(){return parseInt(this.recordId)},Formodel.prototype._handleUpdate=function(t,e){t.handleUpdate(t,e),t.clearAfterUpdate&&t["new"]()},Formodel.prototype._handleStore=function(t,e){t.handleStore(t,e),t.clearAfterStore&&t["new"]()},Formodel.prototype._handleDelete=function(t,e){t.handleDelete(t,e),t["new"]()},Formodel.prototype._handleGet=function(t,e){t.fillWith(e),t.handleGet(t,e)},Formodel.prototype.setRecordId=function(t){t=parseInt(t),this.recordId=void 0!==t&&null!==t&&t>-1&&!isNaN(t)?t:-1},Formodel.prototype.fillInput=function(t,e,r){switch(t.toLowerCase()){case"checkbox":case"radio":var o='input[type="'+t+'"][name="'+e+'"]';$(o).prop("checked",r).change();break;default:r="string"==typeof r?r.trim():r;var o=t+'[name="'+e+'"]';$(o).val(r)}},Formodel.prototype.fillWith=function(t){var e=this.getAttributes();for(var r in e)this.fillInput(e[r],r,t[r])};